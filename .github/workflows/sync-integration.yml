name: Sync Shared Directory

on:
  push:
    branches: [ main ]
    paths:
      - 'shared/**'
  pull_request:
    types: [closed]
    branches: [ main ]
    paths:
      - 'shared/**'
  workflow_dispatch:

jobs:
  fetch-and-sync:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        team: [
          {
            name: 'right',
            repo: 'KDT-PWA-1-Project-A-Team-Right'
          },
          {
            name: 'left',
            repo: 'KDT-PWA-1-Project-A-Team-Left'
          }
        ]
    steps:
      - name: Checkout center repository
        uses: actions/checkout@v4
        with:
          path: center-repo

      - name: Checkout team repository
        uses: actions/checkout@v4
        with:
          repository: KDT-PWA-Class-One-Group/${{ matrix.team.repo }}
          path: team-repo
          token: ${{ secrets.PAT_TOKEN }}

      - name: Sync shared directory
        run: |
          # 팀 저장소의 shared 디렉토리를 center로 복사
          rm -rf center-repo/shared
          cp -r team-repo/shared center-repo/

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.PAT_TOKEN }}
          path: center-repo
          commit-message: "chore: sync shared directory from ${{ matrix.team.name }} team"
          title: "🔄 Sync shared directory from ${{ matrix.team.name }} team"
          body: |
            This PR syncs the shared directory from ${{ matrix.team.name }} team repository.

            Please review the changes carefully before merging.
          branch: sync/shared-from-${{ matrix.team.name }}
          base: main
          labels: |
            sync
            automated
